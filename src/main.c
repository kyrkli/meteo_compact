/*
 * status_display.c
 *
 * Created: 04.05.2025 21:37:20
 * Author : werbu
 */ 
#include <avr/io.h>
#include <util/delay.h>
#include <avr/interrupt.h>
#include <stdlib.h>
#include <stdio.h>
#include "DHT.h"
#include "usart.h"
#include "lcd.h"
#include "DS1302.h"

#include "joystick.h"

#include <avr/pgmspace.h>

const unsigned char cat_bitmap [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x48, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x0a, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x91, 0x00, 0x00, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2a, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x94, 0x80, 0x00, 0x00, 0x00, 0x00, 0x90, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2a, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0xa5, 0x20, 0x00, 0x00, 0x00, 0x01, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xaa, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x24, 0x90, 0x00, 0x00, 0x90, 0x02, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x01, 0x02, 0x24, 0x94, 0x01, 0x51, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x48, 0xa0, 0x00, 0x00, 0x00, 0x08, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x02, 0x00, 0x00, 0x00, 0x01, 0x55, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x10, 0x94, 0x80, 0x00, 0x10, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x42, 0x00, 0x00, 0x00, 0x02, 0xa8, 0xa0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x10, 0xa0, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x04, 0x04, 0x00, 0x00, 0x02, 0xa0, 0x90, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x40, 0x80, 0x10, 0x00, 0x00, 0x14, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x24, 0x80, 0x20, 0x12, 0x40, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x02, 0x00, 0x00, 0x00, 0x02, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x20, 0x80, 0x00, 0x08, 0x00, 0x40, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x21, 0x04, 0x00, 0x24, 0x2a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x04, 0x00, 0x00, 0x11, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x02, 0x00, 0x10, 0x82, 0x08, 0x21, 0x24, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x20, 0x88, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x80, 0x84, 0x00, 0x10, 0x02, 0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x08, 0x00, 0x42, 0x24, 0xa8, 0x90, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x20, 0x10, 0x04, 0x08, 0x08, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x01, 0x01, 0x02, 0x00, 0x20, 0x42, 0x81, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x10, 0x00, 0x10, 0x0a, 0x50, 0x50, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x40, 0x41, 0x02, 0x20, 0x05, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x08, 0x10, 0x00, 0x0a, 0x40, 0x48, 0x48, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x02, 0x00, 0x40, 0x92, 0x40, 0x05, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x15, 0x40, 0x50, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x02, 0xa0, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x01, 0x02, 0x20, 0x10, 0x14, 0x00, 0x90, 0x48, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x02, 0xa1, 0x04, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x11, 0x10, 0x80, 0x28, 0x00, 0x22, 0x48, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x80, 0x00, 0x12, 0xa8, 0x84, 0x88, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x20, 0x00, 0x00, 0xa4, 0x40, 0x42, 0xa0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x81, 0x10, 0x02, 0x50, 0x02, 0x14, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x10, 0x01, 0x01, 0x09, 0x21, 0x05, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x80, 0x84, 0x02, 0xa0, 0x88, 0x52, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x08, 0x00, 0x10, 0x92, 0x42, 0x11, 0x28, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x40, 0x92, 0x05, 0x41, 0x54, 0xa4, 0x48, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x04, 0x02, 0x24, 0x48, 0x52, 0x22, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x21, 0x54, 0x8a, 0x82, 0xa9, 0x50, 0xa0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x10, 0x02, 0x40, 0xa0, 0x14, 0x8a, 0xa0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x05, 0x51, 0x22, 0x04, 0xaa, 0x55, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x20, 0x09, 0x20, 0x04, 0x15, 0x55, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x0a, 0xa4, 0x80, 0x49, 0x55, 0x2a, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x24, 0xa8, 0x04, 0x54, 0xa5, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x15, 0x4a, 0x00, 0x52, 0xaa, 0xaa, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x22, 0xaa, 0x08, 0x92, 0x54, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x05, 0x48, 0x00, 0xa5, 0x55, 0x50, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x25, 0x54, 0x15, 0x55, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x12, 0x42, 0xa4, 0xaa, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x01, 0x2a, 0x2a, 0xa8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x11, 0x55, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

const unsigned char sun_bitmap [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x30, 0x00, 0xc0, 0x03, 0x00, 0x00, 0x00, 0x38, 0x00, 
	0x00, 0x07, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x1c, 
	0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x03, 0x00, 0xc0, 0x30, 0x00, 0x00, 
	0x00, 0x00, 0x0f, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x30, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x01, 0x80, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 
	0xc0, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x40, 0x00, 
	0x00, 0x00, 0x01, 0x80, 0x00, 0x60, 0x00, 0x00, 0x0f, 0xe1, 0x80, 0x00, 0x63, 0xf8, 0x00, 0x0f, 
	0xe1, 0x80, 0x00, 0x63, 0xf8, 0x00, 0x00, 0x01, 0x80, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x80, 
	0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0xc0, 
	0x00, 0x00, 0x00, 0x00, 0x60, 0x01, 0x80, 0x00, 0x00, 0x00, 0x00, 0x30, 0x03, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x1c, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x03, 
	0x01, 0xe0, 0x30, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x00, 
	0x1c, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x38, 0x00, 0x40, 0x07, 0x00, 
	0x00, 0x00, 0x30, 0x00, 0xc0, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

const unsigned char sun2_bitmap [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x01, 0x80, 0x00, 
	0x00, 0x00, 0x00, 0x60, 0x01, 0x80, 0x00, 0x00, 0x00, 0x00, 0x60, 0x01, 0x80, 0x00, 0x00, 0x00, 
	0x00, 0x70, 0x03, 0x80, 0x00, 0x00, 0x00, 0x00, 0x70, 0x03, 0x80, 0x00, 0x00, 0x00, 0x00, 0x30, 
	0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x0f, 0xfc, 0x00, 0x00, 0x00, 0x03, 0xe0, 0x1c, 0x0e, 0x01, 0xf0, 0x00, 0x03, 0xf8, 
	0x30, 0x03, 0x07, 0xf0, 0x00, 0x00, 0x78, 0x60, 0x01, 0x87, 0x80, 0x00, 0x00, 0x00, 0xc0, 0x00, 
	0xc0, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x40, 0x00, 
	0x00, 0x00, 0x01, 0x80, 0x00, 0x60, 0x00, 0x00, 0x00, 0x01, 0x80, 0x00, 0x60, 0x00, 0x00, 0x00, 
	0x01, 0x80, 0x00, 0x60, 0x00, 0x00, 0x00, 0x01, 0x80, 0x00, 0x60, 0x00, 0x00, 0x00, 0x00, 0x80, 
	0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0xc0, 
	0x00, 0x00, 0x00, 0x78, 0x60, 0x01, 0x87, 0x80, 0x00, 0x03, 0xf8, 0x30, 0x03, 0x07, 0xf0, 0x00, 
	0x03, 0xe0, 0x1c, 0x0e, 0x01, 0xf0, 0x00, 0x00, 0x00, 0x0f, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x01, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x03, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x70, 0x03, 0x80, 0x00, 0x00, 0x00, 0x00, 0x70, 0x03, 0x80, 0x00, 0x00, 0x00, 
	0x00, 0x60, 0x01, 0x80, 0x00, 0x00, 0x00, 0x00, 0x60, 0x01, 0x80, 0x00, 0x00, 0x00, 0x00, 0x60, 
	0x01, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

const unsigned char cold_bitmap [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0xc8, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x03, 0xd0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 
	0xc0, 0x20, 0x00, 0x00, 0x00, 0x09, 0x00, 0xc0, 0x24, 0x00, 0x00, 0x00, 0x05, 0x02, 0xd0, 0x28, 
	0x00, 0x00, 0x00, 0x03, 0x00, 0xc0, 0x30, 0x00, 0x00, 0x00, 0x1f, 0x00, 0xc0, 0x3e, 0x00, 0x00, 
	0x00, 0x00, 0xc0, 0xc0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xc0, 0xc0, 0x00, 0x00, 0x00, 0x00, 
	0x27, 0xf9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x06, 
	0x00, 0x00, 0x00, 0x00, 0x80, 0x31, 0xe3, 0x00, 0x40, 0x00, 0x00, 0x44, 0x22, 0x11, 0x08, 0x80, 
	0x00, 0x00, 0x20, 0x25, 0x29, 0x01, 0x00, 0x00, 0x00, 0x33, 0x24, 0xc9, 0x33, 0x00, 0x00, 0x01, 
	0xff, 0xe0, 0xc9, 0xff, 0xe0, 0x00, 0x00, 0x20, 0x24, 0x29, 0x01, 0x00, 0x00, 0x00, 0x44, 0x22, 
	0x11, 0x08, 0x80, 0x00, 0x00, 0x80, 0x31, 0xe3, 0x00, 0x40, 0x00, 0x00, 0x00, 0x18, 0x06, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x1c, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x27, 0xf9, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0xc0, 0xc0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xc0, 0xc0, 0x00, 0x00, 0x00, 0x1f, 
	0x00, 0xc0, 0x3e, 0x00, 0x00, 0x00, 0x03, 0x00, 0xc0, 0x30, 0x00, 0x00, 0x00, 0x05, 0x02, 0xd0, 
	0x28, 0x00, 0x00, 0x00, 0x09, 0x00, 0xc0, 0x24, 0x00, 0x00, 0x00, 0x01, 0x00, 0xc0, 0x20, 0x00, 
	0x00, 0x00, 0x00, 0x01, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xd0, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x04, 0xc8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

const unsigned char cold_bitmap2 [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x09, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x24, 0x0b, 0x80, 0x00, 0x00, 0x00, 0x00, 0x08, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 
	0x07, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x30, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x16, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x0c, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x10, 0x08, 0x0d, 0x00, 0x00, 0x00, 
	0x00, 0x10, 0x04, 0x1c, 0x02, 0x00, 0x00, 0x00, 0x50, 0x02, 0x98, 0x02, 0x00, 0x00, 0x00, 0xf9, 
	0x07, 0x78, 0x06, 0xc0, 0x00, 0x00, 0x7c, 0x0e, 0x1c, 0x06, 0x00, 0x00, 0x00, 0x3f, 0x90, 0x02, 
	0x3b, 0x00, 0x00, 0x00, 0xc3, 0xf1, 0xe3, 0x50, 0xc0, 0x00, 0x00, 0x04, 0xf2, 0x13, 0x80, 0x00, 
	0x00, 0x00, 0x00, 0x24, 0x89, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0xe8, 0x80, 0x00, 0x00, 0x00, 
	0x00, 0x44, 0xc9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x49, 0x00, 0x00, 0x00, 0x00, 0x00, 0x72, 
	0x13, 0xc8, 0x00, 0x00, 0x00, 0xc2, 0xb1, 0xe3, 0xf0, 0xc0, 0x00, 0x00, 0x37, 0x10, 0x02, 0x7f, 
	0x00, 0x00, 0x00, 0x18, 0x0e, 0x1c, 0x0f, 0x80, 0x00, 0x00, 0xd8, 0x07, 0xb8, 0x27, 0xc0, 0x00, 
	0x00, 0x10, 0x06, 0x50, 0x02, 0x80, 0x00, 0x00, 0x10, 0x0e, 0x08, 0x02, 0x00, 0x00, 0x00, 0x00, 
	0x2c, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1a, 0x04, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x03, 0x00, 0x00, 0x00, 0x00, 0x01, 0xf8, 0x07, 0xc0, 0x00, 
	0x00, 0x00, 0x00, 0x38, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x74, 0x09, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x24, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};


DateTime dt;

void setup_DS1302()
{

	if (DS1302_isHalted())
	{
		dt.year = 25;
		dt.month = MONTH_DEC;
		dt.day = 13;
		dt.hour = 11;
		dt.minute = 26;
		dt.second = 00;
		dt.dow = DOW_SAT;

		DS1302_setDateTime(&dt);

		start();
	}
	
	_delay_ms(100);
}
#define LED_BLUE_PIN D, 6
#define LED_GREEN_PIN D, 7
#define LED_RED_PIN B, 0

typedef enum{
	HUM_NOT_INIT,
	HUM_ERROR,
	HUM_VERY_DRY,
	HUM_DRY,
	HUM_COMFORT,
	HUM_HUMID,
	HUM_VERY_HUMID
} humidity_level;

humidity_level get_humidity_level(double hum){
	if(hum <= 20) return HUM_VERY_DRY;
	else if(hum <= 40) return HUM_DRY;
	else if(hum <= 60) return HUM_COMFORT;
	else if(hum <= 75) return HUM_HUMID;
	else return HUM_VERY_HUMID;
}

void rgb_hum_level(humidity_level hum_level){
	switch (hum_level)
	{
		case HUM_VERY_DRY: 	// red
			DigitalWrite(LED_RED_PIN, High);
			DigitalWrite(LED_GREEN_PIN, Low);
			DigitalWrite(LED_BLUE_PIN, Low);
			break;
		case HUM_DRY: 		// yellow
			DigitalWrite(LED_RED_PIN, High);
			DigitalWrite(LED_GREEN_PIN, High);
			DigitalWrite(LED_BLUE_PIN, Low);
			break;
		case HUM_COMFORT: 	// green
			DigitalWrite(LED_RED_PIN, Low);
			DigitalWrite(LED_GREEN_PIN, High);
			DigitalWrite(LED_BLUE_PIN, Low);
			break;
		case HUM_HUMID:		// cyan
			DigitalWrite(LED_RED_PIN, Low);
			DigitalWrite(LED_GREEN_PIN, High);
			DigitalWrite(LED_BLUE_PIN, High);
			break;
		case HUM_VERY_HUMID: // blue
			DigitalWrite(LED_RED_PIN, Low);
			DigitalWrite(LED_GREEN_PIN, Low);
			DigitalWrite(LED_BLUE_PIN, High);
			break;
		default: 			// purple (error state)
			DigitalWrite(LED_RED_PIN, High);
			DigitalWrite(LED_GREEN_PIN, Low);
			DigitalWrite(LED_BLUE_PIN, High);
			break;
	}
}

#include "menu.h"

int main(void)
{
	//Variables
	double temperature;
	double humidity;
	char buf[16];
	DateTime current_time;

	DHT_Setup();
	lcd_init(LCD_DISP_ON);    // init lcd and turn on
	USART_Init();
	DS1302_init();
	joystick_init();

	sei();
	
	PinMode(LED_BLUE_PIN, Output);
	PinMode(LED_GREEN_PIN, Output);
	PinMode(LED_RED_PIN, Output);

	humidity_level prev_hum_level = HUM_NOT_INIT;
	humidity_level curr_hum_level;
	//setup_DS1302();
    /* Replace with your application code */

	SCREEN_STATE current_screen = SCREEN_INFO;
	joystick_data jdata;
	bool is_screen_updated = false;

	DateTime start_time;
	DS1302_getDateTime(&start_time);
	uint8_t y_cold = 0;

    while (1) 
    {
		jdata = joystick_read();

		if(jdata.x > 900){
			current_screen++;
			if(current_screen == (SCREEN_GRAPHS + 1)) current_screen = 0;
			is_screen_updated = true;
			_delay_ms(300);
		}
		else if (jdata.x < 100) {

            if (current_screen == 0) current_screen = SCREEN_GRAPHS;
            else current_screen--;
            is_screen_updated = true;
            //need_full_redraw = 1;
            _delay_ms(300);
        }

		if(is_screen_updated){
			lcd_clrscr();
			is_screen_updated = false;
		}

		lcd_clear_buffer();

		switch (current_screen)
		{
		case SCREEN_INFO:
			DHT_Read(&temperature, &humidity);
			
			if(DHT_GetStatus() == DHT_Ok){
				dtostrf(temperature, 1, 1, buf);
				
				lcd_gotoxy(3,0);
				lcd_puts(buf);
				lcd_puts(" Â°C");
				
				dtostrf(humidity, 1, 1, buf);
				lcd_gotoxy(3,2);
				lcd_puts(buf);
				lcd_puts(" %RH");
				
				curr_hum_level = get_humidity_level(humidity);
				if(curr_hum_level != prev_hum_level)
					rgb_hum_level(curr_hum_level);
				prev_hum_level = curr_hum_level; 
			}
			else {
				sprintf(buf, "DHT Error");
				lcd_gotoxy(3,0);
				lcd_puts(buf);

				curr_hum_level = HUM_ERROR;
				if(curr_hum_level != prev_hum_level)
					rgb_hum_level(curr_hum_level);
				prev_hum_level = curr_hum_level; 
			}

			DS1302_getDateTime(&current_time);
			//print current time
			sprintf(buf, "%02u:%02u:%02u", current_time.hour, current_time.minute, current_time.second);
			lcd_gotoxy(3,4);
			lcd_puts(buf);
			break;
		case SCREEN_SYSTEM:
			
			sprintf(buf, "System Uptime:");
			lcd_gotoxy(0,0);
			lcd_puts(buf);

			DS1302_getDateTime(&current_time);
			
			uint8_t y = 1;

			if(current_time.hour > start_time.hour){
				sprintf(buf, "Hours: %u", (current_time.hour - start_time.hour));
				lcd_gotoxy(0,y++);
				lcd_puts(buf);
			}

			if(current_time.minute > start_time.minute){
				sprintf(buf, "Minutes: %u", (current_time.minute - start_time.minute));
				lcd_gotoxy(0,y++);
				lcd_puts(buf);
			}

			if(current_time.second > start_time.second){
				sprintf(buf, "Seconds: %u", (current_time.second - start_time.second));
				lcd_gotoxy(0,y++);
				lcd_puts(buf);
			}

			break;
		case SCREEN_IDLE:
			lcd_drawBitmap(8, 0, cat_bitmap, 128, 64, 1);
			lcd_drawBitmap(72, y_cold, cold_bitmap, 50, 50, 1);
			y_cold += 3;

			lcd_display();
			_delay_ms(1000);

			lcd_drawBitmap(72, y_cold, cold_bitmap2, 50, 50, 1);
			if(y_cold >= 50)
				y_cold = 0;
			else y_cold += 3;

			// lcd_gotoxy(40, 6);
			// lcd_puts("Zzz...");
			break;
		case SCREEN_GRAPHS:
			jdata = joystick_read();
			//lcd_clrscr();
			sprintf(buf, "x=%04u", jdata.x);
			lcd_gotoxy(0,2);
			lcd_puts(buf);
			sprintf(buf, "y=%04u", jdata.y);
			lcd_gotoxy(0,4);
			lcd_puts(buf);
			sprintf(buf, "b=%04u", jdata.is_pressed);
			lcd_gotoxy(0,6);
			lcd_puts(buf);
			break;
		default:
			break;
		}
		lcd_display();
	
		//Sensor needs 1-2s to stabilize its readings
		_delay_ms(1000);
    }
}

